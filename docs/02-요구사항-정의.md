# CareBridge Korea - 요구사항 정의

## 기능 요구사항

### 1. 인증/인가 (Authentication/Authorization)

#### 1.1 JWT 기반 인증
- 로그인 시 Access Token과 Refresh Token 발급
- Access Token 만료 시 Refresh Token으로 재발급
- 비밀번호는 암호화하여 저장 (bcrypt)

#### 1.2 역할 기반 접근 제어 (RBAC)
- **USER**: 일반 사용자
  - 상담 신청
  - 추천 병원 선택
  - 내 정보 조회
- **ADMIN**: 운영자
  - 모든 USER 권한
  - 상담 목록/상세 조회 및 관리
  - 병원 CRUD
  - 병원 추천 등록
  - 예약 결과 기록

### 2. 사용자 관리 (Users)

| 기능 | 권한 | 설명 |
|------|------|------|
| 회원가입 | Public | 이메일, 비밀번호로 가입 |
| 로그인 | Public | JWT 토큰 발급 |
| 토큰 재발급 | User | Refresh Token으로 Access Token 재발급 |
| 비밀번호 변경 | User | 본인 비밀번호 변경 |
| 내 정보 조회 | User | 본인 정보 조회 |
| 유저 단일 조회 | Admin | 특정 유저 정보 조회 |
| 유저 전체 조회 | Admin | 모든 유저 목록 조회 |

### 3. 상담 관리 (Consultations)

| 기능 | 권한 | 설명 |
|------|------|------|
| 상담 접수 | Public | 비회원도 가능, 증상/연락처/희망일시 등 입력 |
| 상담 목록 조회 | Admin | 상태별 필터링, 페이지네이션 |
| 상담 상세 조회 | Admin | 특정 상담 상세 정보 |
| 상담 상태/메모 수정 | Admin | 처리 상태 변경, 운영자 메모 작성 |

#### 상담 상태 흐름
```
NEW → IN_PROGRESS → COMPLETED
```

#### 연락 수단
- KAKAOTALK
- WHATSAPP
- EMAIL

### 4. 병원 관리 (Hospitals)

| 기능 | 권한 | 설명 |
|------|------|------|
| 병원 등록 | Admin | 새 병원 정보 추가 |
| 병원 수정 | Admin | 기존 병원 정보 수정 |
| 병원 삭제 | Admin | 병원 정보 삭제 |
| 병원 목록 조회 | Admin | 지역/진료과별 필터링 |

### 5. 추천 관리 (Recommendations)

| 기능 | 권한 | 설명 |
|------|------|------|
| 병원 추천 등록 | Admin | 상담 건에 병원 1~3곳 추천 |
| 사용자 선택 기록 | User | 추천된 병원 중 하나 선택 |
| 예약 결과 기록 | Admin | 최종 예약 성공/실패 기록 |

#### 예약 상태
- PENDING: 대기 중
- SUCCESS: 예약 성공
- FAILED: 예약 실패

---

## 비기능 요구사항

### 1. 보안
- [x] JWT 기반 인증
- [x] 비밀번호 암호화 (bcrypt)
- [x] Role 기반 접근 제어

### 2. API 설계
- [x] RESTful API 설계
- [x] 일관된 JSON 응답 포맷
- [x] 명확한 에러 코드와 메시지

### 3. 문서화
- [x] Swagger를 통한 API 문서 자동 생성
- [x] 테스트 가능한 인터페이스 제공

### 4. CORS
- [x] 프론트엔드 개발 환경 허용 (localhost:3000)
- [x] 프로덕션 도메인 허용 (carebridgekorea.netlify.app)

### 5. 데이터 무결성
- [x] 한 상담 건에 동일 병원 중복 추천 방지 (Unique Constraint)
- [x] 외래 키 제약 조건

---

## 제약 사항

1. **중복 추천 방지**: `recommendations` 테이블에서 `consultation_id` + `hospital_id` 조합이 유니크해야 함
2. **비회원 상담**: `consultations.user_id`는 Nullable (비회원 허용)
3. **데이터 자산화**: 모든 상담 및 추천 로그가 정형화된 데이터로 축적되어야 함
