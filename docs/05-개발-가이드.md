# CareBridge Korea - 개발 가이드

## 프로젝트 구조

```
backend/
├── src/
│   ├── common/                 # 공통 모듈
│   │   ├── decorators/         # 커스텀 데코레이터
│   │   ├── filters/            # Exception Filters
│   │   ├── guards/             # Auth Guards
│   │   ├── interceptors/       # Interceptors
│   │   └── dto/                # 공통 DTO
│   │
│   ├── config/                 # 설정
│   │   └── database.config.ts
│   │
│   ├── modules/
│   │   ├── auth/               # 인증 모듈
│   │   │   ├── dto/
│   │   │   ├── guards/
│   │   │   ├── strategies/
│   │   │   ├── auth.controller.ts
│   │   │   ├── auth.service.ts
│   │   │   └── auth.module.ts
│   │   │
│   │   ├── users/              # 사용자 모듈
│   │   │   ├── dto/
│   │   │   ├── entities/
│   │   │   ├── users.controller.ts
│   │   │   ├── users.service.ts
│   │   │   └── users.module.ts
│   │   │
│   │   ├── consultations/      # 상담 모듈
│   │   │   ├── dto/
│   │   │   ├── entities/
│   │   │   ├── consultations.controller.ts
│   │   │   ├── consultations.service.ts
│   │   │   └── consultations.module.ts
│   │   │
│   │   ├── hospitals/          # 병원 모듈
│   │   │   ├── dto/
│   │   │   ├── entities/
│   │   │   ├── hospitals.controller.ts
│   │   │   ├── hospitals.service.ts
│   │   │   └── hospitals.module.ts
│   │   │
│   │   └── recommendations/    # 추천 모듈
│   │       ├── dto/
│   │       ├── entities/
│   │       ├── recommendations.controller.ts
│   │       ├── recommendations.service.ts
│   │       └── recommendations.module.ts
│   │
│   ├── app.module.ts
│   └── main.ts
│
├── test/                       # 테스트
├── .env.example                # 환경변수 예시
├── package.json
└── tsconfig.json
```

---

## 환경 설정

### 환경 변수 (.env)

```env
# Server
PORT=3000
NODE_ENV=development

# Database
DB_HOST=localhost
DB_PORT=3306
DB_USERNAME=root
DB_PASSWORD=password
DB_DATABASE=carebridge

# JWT
JWT_SECRET=your-secret-key
JWT_ACCESS_EXPIRATION=15m
JWT_REFRESH_EXPIRATION=7d

# CORS
CORS_ORIGINS=http://localhost:3000,https://carebridgekorea.netlify.app
```

---

## 실행 방법

### 개발 환경
```bash
# 의존성 설치
npm install

# 개발 서버 실행
npm run start:dev
```

### 프로덕션 환경
```bash
# 빌드
npm run build

# 프로덕션 실행
npm run start:prod
```

### 테스트
```bash
# 단위 테스트
npm run test

# e2e 테스트
npm run test:e2e

# 테스트 커버리지
npm run test:cov
```

---

## API 문서 (Swagger)

개발 서버 실행 후 아래 URL에서 API 문서 확인 가능:

```
http://localhost:3000/api/docs
```

---

## 코드 컨벤션

### 네이밍 규칙

| 구분 | 규칙 | 예시 |
|------|------|------|
| 클래스 | PascalCase | `UserService` |
| 메서드/변수 | camelCase | `findById`, `userName` |
| 상수 | UPPER_SNAKE_CASE | `JWT_SECRET` |
| 파일 | kebab-case | `user.service.ts` |
| 테이블/컬럼 | snake_case | `user_id`, `created_at` |

### DTO 네이밍
- 생성: `Create{Entity}Dto`
- 수정: `Update{Entity}Dto`
- 응답: `{Entity}ResponseDto`

### API 경로 규칙
- 일반 사용자: `/api/v1/{resource}`
- 관리자 전용: `/api/v1/admin/{resource}`

---

## 인증/인가 구현

### JWT Strategy
```typescript
// Access Token에 포함되는 정보
interface JwtPayload {
  sub: number;      // user id
  email: string;
  role: Role;
}
```

### Guards 사용법
```typescript
// 인증 필요
@UseGuards(JwtAuthGuard)

// 관리자 전용
@UseGuards(JwtAuthGuard, RolesGuard)
@Roles(Role.ADMIN)
```

---

## 에러 처리

### 전역 Exception Filter
모든 에러는 일관된 형식으로 응답됩니다:

```typescript
{
  success: false,
  error: {
    code: 'ERROR_CODE',
    message: '에러 메시지'
  }
}
```

### 커스텀 Exception
```typescript
throw new BadRequestException({
  code: 'VALIDATION_ERROR',
  message: '이메일 형식이 올바르지 않습니다.'
});
```

---

## 데이터베이스 마이그레이션

### TypeORM CLI 설정
```bash
# 마이그레이션 생성
npm run migration:generate -- -n MigrationName

# 마이그레이션 실행
npm run migration:run

# 마이그레이션 롤백
npm run migration:revert
```

---

## 체크리스트

### 기능 구현
- [ ] JWT 인증 (로그인/회원가입/토큰 재발급)
- [ ] Role 기반 접근 제어 (RBAC)
- [ ] 사용자 CRUD
- [ ] 상담 CRUD
- [ ] 병원 CRUD
- [ ] 추천 CRUD
- [ ] 중복 추천 방지 (Unique Constraint)

### 비기능 구현
- [ ] Swagger 문서화
- [ ] CORS 설정
- [ ] 일관된 응답 형식
- [ ] 에러 핸들링
- [ ] 입력값 검증 (class-validator)

### 배포 준비
- [ ] 환경 변수 설정
- [ ] 데이터베이스 마이그레이션
- [ ] PM2 설정
- [ ] 로깅 설정
